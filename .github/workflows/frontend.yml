name: Frontend Build

on:
  push:
    branches: [ main, fix/tests-invariants-and-hardenings ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID: fd551fec07a207f377b21f6e56129e66
      NEXT_PUBLIC_MAINNET_RPC_URL: https://eth-mainnet.g.alchemy.com/v2/FHFp4HdZMnOJ41n_U8xX6
      NEXT_PUBLIC_CHAIN: mainnet
      NEXT_CHAIN_ID: 1
      NEXT_PUBLIC_MOCK_USDC_ADDRESS: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606EB48
      NEXT_PUBLIC_CIRCUIT_BREAKER_ADDRESS: 0x7d52F7618490501aE0d0282A8268b6781bc01e91
      NEXT_PUBLIC_TREASURY_ADDRESS: 0x06BFC31847419a8c396B25dB13B15118fee72649
      NEXT_PUBLIC_EPOCH_MANAGER_ADDRESS: 0x0D39119f0703Be13F6c239d415181574bB0637C0
      NEXT_PUBLIC_REWARD_DISTRIBUTOR_ADDRESS: 0xBFeabaa0253C197F5fB08D0CFa060A0E5B318b39
      NEXT_PUBLIC_PARTICIPATION_VAULT_ADDRESS: 0x06306d22b1e765aBB1F471f5B23e60bE3E1C52Fa
      NEXT_PUBLIC_REVENUE_ORACLE_ADDRESS: 0x66A781191Cf7DEb67a02a700721c4811a70237AC

    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    - name: Install dependencies
      run: cd frontend && npm ci
    - name: Run build
      run: cd frontend && npm run build
      env:
        NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID: ${{ secrets.WALLETCONNECT_PROJECT_ID }}
    - name: Run lint (if available)
      run: cd frontend && npm run lint || echo "No lint script"
